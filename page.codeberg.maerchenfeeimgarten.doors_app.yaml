id: page.codeberg.maerchenfeeimgarten.doors_app

runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
  
command: "doors_app"
finish-args:
  - --socket=wayland # Permission needed to show the window
  - --socket=fallback-x11 # Permission needed to show the window
  - --share=ipc # is needed because of x11
  
modules:
  - name: doors_app
    buildsystem: simple
    build-options:
        append-path: /usr/lib/sdk/rust-stable/bin
        env:
          CARGO_HOME: /run/build/v-extract/doors_app/cargo

    sources:
      - type: archive
        url: https://codeberg.org/MaerchenfeeimGarten/doors_app/archive/v0.1.5.tar.gz
        sha256: d0943fb7bcaed152a9c911782f0ffb28b6867e9d2ae136f25efdf2937b61ddef
      - type: archive
        url: https://codeberg.org/MaerchenfeeimGarten/cargo_vendored_version_of_tauri-cli/archive/v0.0.2.tar.gz
        sha256: 67ca2ce2b046f53a14a7748fbf0b44220cdba784cb9d580c1f96aada475e7a35
        
    build-commands:
    
      # build cargo-tauri build command
      - |
        cd cargo_vendored_version_of_tauri-cli
        cargo --offline build 
        
      #build .deb file
      - ./cargo_vendored_version_of_tauri-cli/target/debug/cargo-tauri build -b deb

      
      # Extract the deb package
      - cp src-tauri/target/release/bundle/deb/*.deb ./
      - mkdir deb-extract
      - ar -x *.deb --output deb-extract
      - tar -C deb-extract -xf deb-extract/data.tar.gz

      # Copy binary
      - 'install -Dm755 deb-extract/usr/bin/doors_app /app/bin/doors_app'
      
      # Copy desktop file
      - install -Dm644 page.codeberg.maerchenfeeimgarten.doors_app.desktop /app/share/applications/page.codeberg.maerchenfeeimgarten.doors_app.desktop

      # Copy icons
      - install -Dm644 deb-extract/usr/share/icons/hicolor/128x128/apps/doors_app.png /app/share/icons/hicolor/128x128/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 deb-extract/usr/share/icons/hicolor/32x32/apps/doors_app.png /app/share/icons/hicolor/32x32/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 deb-extract/usr/share/icons/hicolor/256x256@2/apps/doors_app.png /app/share/icons/hicolor/256x256@2/apps/page.codeberg.maerchenfeeimgarten.doors_app.png
      - install -Dm644 page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml /app/share/metainfo/page.codeberg.maerchenfeeimgarten.doors_app.metainfo.xml
